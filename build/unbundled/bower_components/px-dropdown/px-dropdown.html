<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="px-dropdown-content.html">
<link rel="import" href="px-dropdown-chevron.html">
<link rel="import" href="px-dropdown-text.html">

</head><body><dom-module id="px-dropdown">
  <link rel="import" type="css" href="css/px-dropdown.css">
  <template>
    <div on-tap="triggerClicked" on-mouseover="_hoverOn" on-mouseout="_hoverOff" class$="{{_dropcellClass(opened, hover)}} flex flex--middle dropcell" id="dropcell">
      <px-dropdown-text display-value="{{displayValue}}" max-cont-character-width="{{_maxCharWidth}}" tooltip-value="{{value}}"></px-dropdown-text>
      <template is="dom-if" if="{{_hideChevron(hideChevron)}}">
        <px-dropdown-chevron class="px-dropdown-chevron"></px-dropdown-chevron>
      </template>
    </div>
    <div style="position:relative">
      <content select="px-dropdown-content"></content>
    </div>
  </template>
</dom-module>
<script>Polymer({is:"px-dropdown",properties:{opened:{type:Boolean,notify:!0,value:!1},hover:{type:Boolean,notify:!0,value:!1},above:{type:Boolean,value:!1},hideChevron:{type:Boolean,value:!1},boundTarget:{type:HTMLElement,value:null},preventCloseOnOutsideClick:{type:Boolean,value:!1},displayValue:{type:String,notify:!0,value:""},_maxCharWidth:{type:Number,notify:!0,value:0},contentAnchor:{type:HTMLElement,value:function(){return null}},value:{type:String,value:"",notify:!0}},observers:["_boundTargetChanged(boundTarget, isAttached)"],listeners:{dropdown_flip:"_flipOpened",dropdown_content_request_size:"_provideCellSize",dropdown_content_value_changed:"_newTextValue",maxContCharacterWidth:"_newMaxContCharWidth"},attached:function(){Polymer.Gestures.add(document,"tap",null);var t="ontouchstart"in window?"tap":"click";document.addEventListener(t,this._onCaptureClick.bind(this),!0),!this.value&&this.displayValue&&this.set("value",this.displayValue)},detached:function(){var t="ontouchstart"in window?"tap":"click";document.removeEventListener(t,this._onCaptureClick.bind(this))},_newTextValue:function(t){this.set("value",t.detail.textValue),this.set("displayValue",t.detail.textValue),this.fire("change"),t.stopPropagation()},_newMaxContCharWidth:function(t){this.set("_maxCharWidth",t.detail.maxContCharacterWidth),t.stopPropagation()},_provideCellSize:function(t){var e=this.contentAnchor?this.contentAnchor:this.$.dropcell,o=e.getBoundingClientRect();t.detail.pxContent.dropCellWidth=o.width,t.detail.pxContent.dropCellHeight=o.height,t.stopPropagation()},_hideChevron:function(t){return!this.hideChevron},_selfInPath:function(t){t=t||[];for(var e=0;e<t.length;e++)if(t[e]===this)return this},_onCaptureClick:function(t){if(!this.preventCloseOnOutsideClick&&!this._selfInPath(Polymer.dom(t).path)&&this.opened){var e=Polymer.dom(this).querySelector("px-dropdown-content");this._flipOpened(),e.close(),this._reset()}},_boundTargetChanged:function(t,e){"string"==typeof t&&(this.boundTarget=this.domHost?this.domHost.$[t]:Polymer.dom(this.ownerDocument).querySelector("#"+t))},_computeValue:function(t){return t},triggerClicked:function(t){var e=Polymer.dom(this).querySelector("px-dropdown-content");this.opened?(e.close(),this._reset()):(e.open(),this._setPosition()),this._flipOpened(),this.fire("dropdownStateChanged",t)},_flipOpened:function(t){this._fireChevron("opened"),this.opened=!this.opened,t&&t.stopPropagation()},_fireChevron:function(t){var e=this.$$("px-dropdown-chevron");e&&e.fire(t)},_dropcellClass:function(t,e){return this.opened?"opened":this.hover?"hover":void 0},_hoverOn:function(){this._fireChevron("hoverOn"),this.hover=!0},_hoverOff:function(){this._fireChevron("hoverOff"),this.hover=!1},_reset:function(){var t=Polymer.dom(this).querySelector("px-dropdown-content"),e=t.$.dropdown;this.above=!1,e.style.top=""},_setPosition:function(){this._reset(),this._positionOnContentAnchor(),null!==this.boundTarget?this.positionWithinBounds(this.boundTarget.getBoundingClientRect()):this._isoffScreenOnBottom()&&this._setTopPosition()},_positionOnContentAnchor:function(){if(this.contentAnchor){var t=Polymer.dom(this).querySelector("px-dropdown-content"),e=t.$.dropdown,o=this.contentAnchor.getBoundingClientRect(),n=this.$.dropcell.getBoundingClientRect();e.style.left=o.left-n.left+"px",e.style.top=o.bottom-n.bottom+"px"}},_isoffScreenOnBottom:function(){var t=Polymer.dom(this).querySelector("px-dropdown-content"),e=t.$.dropdown,o=e.getBoundingClientRect(),n=(t.getBoundingClientRect(),o.bottom);return n>window.innerHeight},positionWithinBounds:function(t){var e,o,n,i,r=Polymer.dom(this).querySelector("px-dropdown-content"),s=r.$.dropdown,h=this.contentAnchor?this.contentAnchor:this.$.dropcell,d=h.getClientRects()[0];r.resetHeight(),e=s.getBoundingClientRect(),o=e.bottom,n=e.top-t.top-parseInt(d.height),i=t.bottom-e.top,o>t.bottom&&(n>e.height?(r.adjustHeight(),this._setTopPosition()):n>i?(r.sizeHeight(n-1),this._setTopPosition()):r.sizeHeight(i-1))},_setTopPosition:function(){var t=Polymer.dom(this).querySelector("px-dropdown-content"),e=t.$.dropdown,o=e.getClientRects()[0],n=this.contentAnchor?this.contentAnchor:this.$.dropcell,i=n.getClientRects()[0],r=parseInt(e.offsetTop)-parseInt(o.height)-parseInt(i.height)+"px";e.style.top=r,this.above=!0}});</script>
</body></html>