lm.items.RowOrColumn=function(t,e,i,n){lm.items.AbstractContentItem.call(this,e,i,n),this.isRow=!t,this.isColumn=t,this.element=$('<div class="lm_item lm_'+(t?"column":"row")+'"></div>'),this.childElementContainer=this.element,this._splitterSize=e.config.dimensions.borderWidth,this._isColumn=t,this._dimension=t?"height":"width",this._splitter=[],this._splitterPosition=null,this._splitterMinPosition=null,this._splitterMaxPosition=null},lm.utils.extend(lm.items.RowOrColumn,lm.items.AbstractContentItem),lm.utils.copy(lm.items.RowOrColumn.prototype,{addChild:function(t,e,i){var n,s,o,h;if(t=this.layoutManager._$normalizeContentItem(t,this),void 0===e&&(e=this.contentItems.length),this.contentItems.length>0?(h=this._createSplitter(Math.max(0,e-1)).element,e>0?(this.contentItems[e-1].element.after(h),h.after(t.element)):(this.contentItems[0].element.before(h),h.before(t.element))):this.childElementContainer.append(t.element),lm.items.AbstractContentItem.prototype.addChild.call(this,t,e),n=1/this.contentItems.length*100,i===!0)return void this.emitBubblingEvent("stateChanged");for(o=0;o<this.contentItems.length;o++)this.contentItems[o]===t?t.config[this._dimension]=n:(s=this.contentItems[o].config[this._dimension]*=(100-n)/100,this.contentItems[o].config[this._dimension]=s);this.callDownwards("setSize"),this.emitBubblingEvent("stateChanged")},removeChild:function(t,e){var i,n,s=t.config[this._dimension],o=lm.utils.indexOf(t,this.contentItems),h=Math.max(o-1,0);if(o===-1)throw new Error("Can't remove child. ContentItem is not child of this Row or Column");for(this._splitter[h]&&(this._splitter[h]._$destroy(),this._splitter.splice(h,1)),i=0;i<this.contentItems.length;i++)this.contentItems[i]!==t&&(this.contentItems[i].config[this._dimension]+=s/(this.contentItems.length-1));lm.items.AbstractContentItem.prototype.removeChild.call(this,t,e),1===this.contentItems.length&&this.config.isClosable===!0?(n=this.contentItems[0],this.contentItems=[],this.parent.replaceChild(this,n,!0)):(this.callDownwards("setSize"),this.emitBubblingEvent("stateChanged"))},replaceChild:function(t,e){var i=t.config[this._dimension];lm.items.AbstractContentItem.prototype.replaceChild.call(this,t,e),e.config[this._dimension]=i,this.callDownwards("setSize"),this.emitBubblingEvent("stateChanged")},setSize:function(){this.contentItems.length>0&&(this._calculateRelativeSizes(),this._setAbsoluteSizes()),this.emitBubblingEvent("stateChanged"),this.emit("resize")},_$init:function(){if(this.isInitialised!==!0){var t;for(lm.items.AbstractContentItem.prototype._$init.call(this),t=0;t<this.contentItems.length-1;t++)this.contentItems[t].element.after(this._createSplitter(t).element)}},_setAbsoluteSizes:function(){var t,e,i,n=(this.contentItems.length-1)*this._splitterSize,s=this.element.width(),o=this.element.height(),h=0,l=[];for(this._isColumn?o-=n:s-=n,t=0;t<this.contentItems.length;t++)i=this._isColumn?Math.floor(o*(this.contentItems[t].config.height/100)):Math.floor(s*(this.contentItems[t].config.width/100)),h+=i,l.push(i);for(e=(this._isColumn?o:s)-h,t=0;t<this.contentItems.length;t++)e-t>0&&l[t]++,this._isColumn?(this.contentItems[t].element.width(s),this.contentItems[t].element.height(l[t])):(this.contentItems[t].element.width(l[t]),this.contentItems[t].element.height(o))},_calculateRelativeSizes:function(){var t,e=0,i=[],n=this._isColumn?"height":"width";for(t=0;t<this.contentItems.length;t++)void 0!==this.contentItems[t].config[n]?e+=this.contentItems[t].config[n]:i.push(this.contentItems[t]);if(100!==Math.round(e))if(Math.round(e)<100&&i.length>0)for(t=0;t<i.length;t++)i[t].config[n]=(100-e)/i.length;else{if(Math.round(e)>100)for(t=0;t<i.length;t++)i[t].config[n]=50,e+=50;for(t=0;t<this.contentItems.length;t++)this.contentItems[t].config[n]=this.contentItems[t].config[n]/e*100}},_createSplitter:function(t){var e;return e=new lm.controls.Splitter(this._isColumn,this._splitterSize),e.on("drag",lm.utils.fnBind(this._onSplitterDrag,this,[e]),this),e.on("dragStop",lm.utils.fnBind(this._onSplitterDragStop,this,[e]),this),e.on("dragStart",lm.utils.fnBind(this._onSplitterDragStart,this,[e]),this),this._splitter.splice(t,0,e),e},_getItemsForSplitter:function(t){var e=lm.utils.indexOf(t,this._splitter);return{before:this.contentItems[e],after:this.contentItems[e+1]}},_onSplitterDragStart:function(t){var e=this._getItemsForSplitter(t),i=this.layoutManager.config.dimensions[this._isColumn?"minItemHeight":"minItemWidth"];this._splitterPosition=0,this._splitterMinPosition=-1*(e.before.element[this._dimension]()-i),this._splitterMaxPosition=e.after.element[this._dimension]()-i},_onSplitterDrag:function(t,e,i){var n=this._isColumn?i:e;n>this._splitterMinPosition&&n<this._splitterMaxPosition&&(this._splitterPosition=n,t.element.css(this._isColumn?"top":"left",n))},_onSplitterDragStop:function(t){var e=this._getItemsForSplitter(t),i=e.before.element[this._dimension](),n=e.after.element[this._dimension](),s=(this._splitterPosition+i)/(i+n),o=e.before.config[this._dimension]+e.after.config[this._dimension];e.before.config[this._dimension]=s*o,e.after.config[this._dimension]=(1-s)*o,t.element.css({top:0,left:0}),lm.utils.animFrame(lm.utils.fnBind(this.callDownwards,this,["setSize"]))}});